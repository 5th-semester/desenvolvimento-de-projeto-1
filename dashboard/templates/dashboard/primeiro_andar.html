{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Primeiro Andar - Análise WiFi{% endblock %}

{% block content %}
<!-- Constrain Chart.js canvases to avoid runaway height growth -->
<style>
  /* Ensure the dashboard quick-view charts have a sane max height */
  #chartHistogram, #chartScatter, #chartStacked {
    max-height: 380px !important;
    height: 380px !important;
    width: 100% !important;
    display: block !important;
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('#chartHistogram,#chartScatter,#chartStacked').forEach(function(c) {
      if (c) {
        c.style.maxHeight = '380px';
        c.style.height = '380px';
        c.style.width = '100%';
      }
    });
  });
</script>

<div class="flex flex-col md:flex-row gap-8">
    <div class="w-full md:w-1/2 bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-semibold mb-4 text-gray-700">Planta Baixa - 1º Andar</h2>
        <img src="{% static 'dashboard/images/planta baixa.jpg' %}" alt="Planta Baixa do 1º Andar" class="w-full h-auto rounded">
    </div>

    <div class="w-full md:w-1/2">
        <h2 class="text-2xl font-semibold mb-4 text-gray-700">Medições de Sinal</h2>
        <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
            <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3">Cômodo</th>
                        <th scope="col" class="px-6 py-3">Potência (dBm)</th>
                        <th scope="col" class="px-6 py-3">Download (Mbps)</th>
                        <th scope="col" class="px-6 py-3">Interferência (%)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sinal in dados_primeiro_andar %}
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ sinal.id }}</th>
                        <td class="px-6 py-4">{{ sinal.dbm }}</td>
                        <td class="px-6 py-4">{{ sinal.download }}</td>
                        <td class="px-6 py-4">{{ sinal.interferencia }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Heatmap visualização -->
        <div class="mt-6">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">Mapa de Calor - 1º Andar</h3>
            <div class="grid grid-cols-5 gap-3">
                {% for sinal in dados_primeiro_andar %}
                <div class="flex items-center justify-center h-20 rounded text-white font-semibold" style="background-color: {{ sinal.heatcolor }};">
                    <div class="text-center">
                        <div class="text-sm">Ponto {{ sinal.id }}</div>
                        <div class="text-xs">{{ sinal.dbm }} dBm</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <p class="text-xs text-gray-500 mt-2">Cores: vermelho = fraco, verde = forte.</p>
        </div>

    </div>
</div>
{% endblock %}
